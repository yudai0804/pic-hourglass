LIST P=PIC16F1827
#include<p16f1827.inc>

CNT0	EQU	0x70
CNT1	EQU	0x71
CNT2	EQU	0x72
CNT EQU 0x73
TMP EQU 0x74
__CONFIG	_CONFIG1, _FOSC_INTOSC & _WDTE_OFF & _PWRTE_ON & _MCLRE_OFF & _CP_OFF & _CPD_OFF & _BOREN_OFF & _CLKOUTEN_OFF & _IESO_OFF & _FCMEN_OFF
__CONFIG	_CONFIG2, _WRT_OFF & _PLLEN_OFF & _STVREN_OFF & _BORV_LO & _LVP_OFF

ORG 0x0000
    CLRF PORTA
    CLRF PORTB
    BSF BSR, BSR0
    BSF BSR, BSR1
    ; バンク3
    ; ディジタル入力を受け入れるようにする
    ; CLRF ANSELAをすると何故かRA4の動きがXORみたいな動きをするようになる。
    ; 今回はANSELAを行わないことで対応
    CLRF ANSELB
    ; バンク1
    BSF BSR, BSR0
    BCF BSR, BSR1
    MOVLW 0x00
    MOVWF TRISA
    MOVLW 0x30
    MOVWF TRISB
    ; バンク0
    BCF BSR, BSR0
    CLRF PORTA
    CLRF PORTB
LOOP
    MOVLW 0xff
    MOVWF CNT
STATE0
    DECFSZ CNT
    GOTO _STATE0
STATE1
    DECFSZ CNT
    GOTO _STATE1
STATE2
    DECFSZ CNT
    GOTO _STATE2
STATE3
    DECFSZ CNT
    GOTO _STATE3
STATE4
    DECFSZ CNT
    GOTO _CLEAR
    GOTO LOOP

_STATE0
    CALL CLOCK0
    GOTO STATE0
 _STATE1
    CALL CLOCK1
    GOTO STATE1
_STATE2
    CALL CLOCK2
    GOTO STATE2
_STATE3
    CALL CLOCK3
    GOTO STATE3
_CLEAR
    CALL CLEAR
    GOTO STATE4

CLOCK0
    CALL D1
    CALL TIMER_10MS
    CALL D2
    CALL TIMER_10MS
    CALL D3
    CALL TIMER_10MS
    CALL D4
    CALL TIMER_10MS
    CALL D5
    CALL TIMER_10MS
    CALL D6
    CALL TIMER_10MS
    RETURN

CLOCK1
    CALL D4
    CALL TIMER_10MS
    CALL D5
    CALL TIMER_10MS
    CALL D6
    CALL TIMER_10MS
    CALL D10
    CALL TIMER_10MS
    CALL D11
    CALL TIMER_10MS
    CALL D12
    CALL TIMER_10MS
    RETURN

CLOCK2
    CALL D6
    CALL TIMER_10MS
    CALL D8
    CALL TIMER_10MS
    CALL D9
    CALL TIMER_10MS
    CALL D10
    CALL TIMER_10MS
    CALL D11
    CALL TIMER_10MS
    CALL D12
    CALL TIMER_10MS
    RETURN
    
CLOCK3
    CALL D7
    CALL TIMER_10MS
    CALL D8
    CALL TIMER_10MS
    CALL D9
    CALL TIMER_10MS
    CALL D10
    CALL TIMER_10MS
    CALL D11
    CALL TIMER_10MS
    CALL D12
    CALL TIMER_10MS
    RETURN

CLEAR
    MOVF PORTA, W
    ANDLW 0b11100011
    ADDLW 0x00
    MOVWF PORTA
    MOVF PORTB, W
    ANDLW 0x11110000
    ADDLW 0x00
    MOVWF PORTB
    CALL TIMER_10MS
    CALL TIMER_10MS
    CALL TIMER_10MS
    CALL TIMER_10MS
    CALL TIMER_10MS
    CALL TIMER_10MS
    RETURN

ALL
    CALL D1
    CALL TIMER_1000MS
    CALL D2
    CALL TIMER_1000MS
    CALL D3
    CALL TIMER_1000MS
    CALL D4
    CALL TIMER_1000MS
    CALL D5
    CALL TIMER_1000MS
    CALL D6
    CALL TIMER_1000MS
    CALL D7
    CALL TIMER_1000MS
    CALL D8
    CALL TIMER_1000MS
    CALL D9
    CALL TIMER_1000MS
    CALL D10
    CALL TIMER_1000MS
    CALL D11
    CALL TIMER_1000MS
    CALL D12
    CALL TIMER_1000MS
    RETURN
    
    ; 10 cycle
D1
    MOVLW 0b11100011
    ANDWF PORTA, 1
    MOVF PORTB, W
    ANDLW 0x11110000
    ADDLW 0x07
    MOVWF PORTB
    MOVLW 0x04
    ADDWF PORTA, 1
    RETURN
D2
    MOVLW 0b11100011
    ANDWF PORTA, 1
    MOVF PORTB, W
    ANDLW 0x11110000
    ADDLW 0x0b
    MOVWF PORTB
    MOVLW 0x04
    ADDWF PORTA, 1
    RETURN
D3
    MOVLW 0b11100011
    ANDWF PORTA, 1
    MOVF PORTB, W
    ANDLW 0x11110000
    ADDLW 0x0d
    MOVWF PORTB
    MOVLW 0x04
    ADDWF PORTA, 1
    RETURN
D4
    MOVLW 0b11100011
    ANDWF PORTA, 1
    MOVF PORTB, W
    ANDLW 0x11110000
    ADDLW 0x07
    MOVWF PORTB
    MOVLW 0x08
    ADDWF PORTA, 1
    RETURN
D5
    MOVLW 0b11100011
    ANDWF PORTA, 1
    MOVF PORTB, W
    ANDLW 0x11110000
    ADDLW 0x0b
    MOVWF PORTB
    MOVLW 0x08
    ADDWF PORTA, 1
    RETURN
D6
    MOVLW 0b11100011
    ANDWF PORTA, 1
    MOVF PORTB, W
    ANDLW 0x11110000
    ADDLW 0x07
    MOVWF PORTB
    MOVLW 0x10
    ADDWF PORTA, 1
    RETURN
D7
    MOVLW 0b11100011
    ANDWF PORTA, 1
    MOVF PORTB, W
    ANDLW 0x11110000
    ADDLW 0x0e
    MOVWF PORTB
    MOVLW 0x04
    ADDWF PORTA, 1
    RETURN
D8
    MOVLW 0b11100011
    ANDWF PORTA, 1
    MOVF PORTB, W
    ANDLW 0x11110000
    ADDLW 0x0d
    MOVWF PORTB
    MOVLW 0x08
    ADDWF PORTA, 1
    RETURN
D9
    MOVLW 0b11100011
    ANDWF PORTA, 1
    MOVF PORTB, W
    ANDLW 0x11110000
    ADDLW 0x0e
    MOVWF PORTB
    MOVLW 0x08
    ADDWF PORTA, 1
    RETURN
D10
    MOVLW 0b11100011
    ANDWF PORTA, 1
    MOVF PORTB, W
    ANDLW 0x11110000
    ADDLW 0x0b
    MOVWF PORTB
    MOVLW 0x10
    ADDWF PORTA, 1
    RETURN
D11
    MOVLW 0b11100011
    ANDWF PORTA, 1
    MOVF PORTB, W
    ANDLW 0x11110000
    ADDLW 0x0d
    MOVWF PORTB
    MOVLW 0x10
    ADDWF PORTA, 1
    RETURN
D12
    MOVLW 0b11100011
    ANDWF PORTA, 1
    MOVF PORTB, W
    ANDLW 0x11110000
    ADDLW 0x0e
    MOVWF PORTB
    MOVLW 0x10
    ADDWF PORTA, 1
    RETURN
    
TIMER_1MS
	MOVLW	D'19'
	MOVWF	CNT1
TIMER_1MS_LABEL1
	NOP
	NOP
	DECFSZ	CNT1,F
	GOTO	TIMER_1MS_LABEL1
	RETURN

TIMER_10MS
	MOVLW	D'19'
	MOVWF	CNT1
TIMER_10MS_LABEL1
	NOP
	NOP
	DECFSZ	CNT1,F
	GOTO	TIMER_10MS_LABEL1
	RETURN

	
    
TIMER_1000MS
	MOVLW	D'173'
	MOVWF	CNT1
TIMER_1000MS_LABEL1
	MOVLW	D'191'
	MOVWF	CNT2
TIMER_1000MS_LABEL2
	DECFSZ	CNT2,F
	GOTO	TIMER_1000MS_LABEL2
	NOP
	DECFSZ	CNT1,F
	GOTO	TIMER_1000MS_LABEL1
	NOP
	RETURN

end